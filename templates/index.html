<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <title>Meme Server</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            color: #fff;
            background: linear-gradient(135deg, #003973, #E5E5BE);
            background-size: 400% 400%;
            animation: gradientShift 12s ease infinite;
            text-align: center;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            margin: 60px auto;
            width: 60%;
            max-width: 900px;
            background: rgba(255,255,255,0.13);
            padding: 35px;
            border-radius: 20px;
            backdrop-filter: blur(12px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.4);
        }

        h1 {
            font-size: 38px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        #memeImage {
            max-width: 90%;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            animation: fade 0.6s ease;
        }

        @keyframes fade {
            from { opacity: 0; }
            to   { opacity: 1; }
        }

        .footer {
            margin-top: 30px;
            font-size: 20px;
        }

        /* Ring countdown */
        .circle-timer {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 20px auto;
        }

        .circle-timer svg {
            transform: rotate(-90deg);
        }

        .circle-bg {
            stroke: rgba(255,255,255,0.3);
            stroke-width: 10;
        }

        .circle-progress {
            stroke: #ff4040;
            stroke-width: 10;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s linear;
        }

        .circle-text {
            position: absolute;
            top: 38px;
            left: 0;
            width: 120px;
            font-size: 26px;
            font-weight: 700;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 id="title">ðŸŒŸ Meme #{{ meme_number }}/{{ total_memes }} ðŸŒŸ</h1>

        <img id="memeImage" src="{{ meme_file }}" alt="Meme">

        <!-- Ring Countdown Display -->
        <div class="circle-timer">
            <svg width="120" height="120">
                <circle cx="60" cy="60" r="50" class="circle-bg"></circle>
                <circle cx="60" cy="60" r="50" class="circle-progress"></circle>
            </svg>
            <div class="circle-text" id="circleText">20</div>
        </div>

        <div class="footer">
            Uus meme: <span id="timer">20</span> sekundi pÃ¤rast
        </div>
    </div>

    <script>
        let timer = 20;
        let totalMemes = {{ total_memes }};
        let currentIndex = {{ meme_number }} - 1;

        const circle = document.querySelector(".circle-progress");
        const circleText = document.getElementById("circleText");

        const radius = 50;
        const circumference = 2 * Math.PI * radius;

        circle.style.strokeDasharray = circumference;
        circle.style.strokeDashoffset = 0;

        function setCircle(percent) {
            const offset = circumference - (percent / 100) * circumference;
            circle.style.strokeDashoffset = offset;
        }

        function updateView() {
            // Update numeric countdown
            document.getElementById("timer").textContent = timer;
            circleText.textContent = timer;

            // Update progress circle
            setCircle((timer / 20) * 100);

            timer--;

            // When time is up â€“ load next meme
            if (timer < 0) {
                timer = 20;
                currentIndex = (currentIndex + 1) % totalMemes;

                fetch("/")
                    .then(r => r.text())
                    .then(html => {
                        // Extract new image
                        const newMatch = html.match(/src="([^"]+)"/);
                        if (newMatch) {
                            document.getElementById("memeImage").src = newMatch[1];
                        }

                        // Update title text
                        document.getElementById("title").textContent =
                            `ðŸŒŸ Meme #${currentIndex + 1}/${totalMemes} ðŸŒŸ`;
                    });
            }
        }

        setInterval(updateView, 1000);
    </script>

</body>
</html>
